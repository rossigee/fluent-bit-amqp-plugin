[SERVICE]
    Flush         1
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf
    Plugins_File  /fluent-bit/plugins/plugins.conf

[INPUT]
    Name              tail
    Path              /var/log/test/*.log
    Tag               app.*
    Refresh_Interval  5
    Read_from_Head    true
    Parser            json

[INPUT]
    Name              dummy
    Dummy             {"timestamp":"2024-01-15T10:30:00Z","level":"info","message":"Test dummy message","service":"test-service","request_id":"req-123456"}
    Tag               dummy
    Rate              5

[FILTER]
    Name              modify
    Match             *
    Add               cluster_name ${CLUSTER_NAME}
    Add               node_name ${NODE_NAME}

[OUTPUT]
    Name                amqp_cloudevents
    Match               app.*
    url                 ${RABBITMQ_URL}
    exchange            ${RABBITMQ_EXCHANGE}
    routing_key         application.${CLUSTER_NAME}.logs
    queue               app-logs-${CLUSTER_NAME}
    event_source        application.${CLUSTER_NAME}
    event_type          application.container.log
    durable             true

[OUTPUT]
    Name                amqp_cloudevents
    Match               dummy
    url                 ${RABBITMQ_URL}
    exchange            ${RABBITMQ_EXCHANGE}
    routing_key         test.${CLUSTER_NAME}.logs
    queue               test-logs-${CLUSTER_NAME}
    event_source        test.${CLUSTER_NAME}
    event_type          test.dummy.log
    durable             true

[OUTPUT]
    Name                stdout
    Match               *
    Format              json_lines